# Git 自动提交与版本管理 - 安装包

> 写给技术小白的保姆级教程

## 这是什么？有什么用？

想象一下，你在用 Word 写文档时，每隔一段时间按 Ctrl+S 保存一下，防止电脑突然死机丢失工作成果。

**Git 自动提交**就像是一个更聪明的"自动保存"功能：
- 它不仅保存你的文件
- 还会记录"什么时候保存的"、"改了多少内容"
- 而且可以随时回到之前的任何一个版本

**版本号（Tag）** 就像是给每次重要保存起一个名字，比如 `0.0.1`、`0.0.2`，方便你以后找到。

---

## 安装步骤（3步完成）

### 第一步：复制文件

把这个压缩包里的文件复制到你的项目中：

```
你的项目/
└── .claude/
    ├── commands/
    │   └── git-commit.md        ← 复制 commands/git-commit.md
    ├── hooks/
    │   └── git-auto-tag-v2/     ← 复制整个 hooks/git-auto-tag-v2/ 文件夹
    └── settings.local.json      ← 复制或合并 settings.local.json
```

**具体操作**：

1. 在你的项目根目录下，创建 `.claude` 文件夹（如果没有的话）
2. 把压缩包里的 `commands`、`hooks` 文件夹复制进去
3. 把 `settings.local.json` 复制进去

> **注意**：如果你的项目已经有 `.claude/settings.local.json` 文件，请参考下面的"合并配置"说明。

### 第二步：安装依赖（可选）

如果你想修改 hook 的源代码，需要安装依赖并编译：

```bash
cd 你的项目/.claude/hooks/git-auto-tag-v2
bun install
bun run build
```

> **如果你不打算修改代码，可以跳过这一步**，因为压缩包里已经包含编译好的 `dist/hook.js`。

### 第三步：验证安装

在你的项目目录下，用 Claude Code 随便编辑一个文件，然后检查是否有自动提交：

```bash
git log --oneline -3
```

如果看到类似 `Auto: 2025-12-06T22-20-59 - 3 files, 100 lines` 的记录，说明安装成功！

---

## 合并配置（如果已有 settings.local.json）

如果你的项目已经有 `.claude/settings.local.json`，需要手动合并 `hooks` 配置。

打开你现有的 `settings.local.json`，添加 `hooks` 部分：

```json
{
  "permissions": {
    ...你现有的配置...
  },
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit|MultiEdit",
        "hooks": [
          {
            "type": "command",
            "command": "node .claude/hooks/git-auto-tag-v2/dist/hook.js",
            "timeout": 30000
          }
        ]
      }
    ]
  }
}
```

---

## 压缩包内容说明

```
git-auto-commit-package/
├── README.md                    # 本教程（你正在看的文件）
├── settings.local.json          # Claude Code 配置文件
├── commands/
│   └── git-commit.md            # /git-commit 手动提交命令
└── hooks/
    └── git-auto-tag-v2/
        ├── dist/
        │   └── hook.js          # 编译好的 hook（直接可用）
        ├── src/
        │   ├── hook.ts          # 源代码：主逻辑
        │   ├── hook-utils.ts    # 源代码：工具函数
        │   └── types.ts         # 源代码：类型定义
        ├── package.json         # 依赖配置
        ├── tsconfig.json        # TypeScript 配置
        └── README.md            # 技术文档
```

---

## 你需要知道的几个概念

### Git 是什么？

Git 是一个"版本控制工具"。简单说：
- 它帮你记录文件的每一次修改
- 你可以随时查看历史记录
- 你可以随时回到之前的版本

就像游戏里的"存档"功能，你可以存很多个档，随时读取任意一个。

### 提交（Commit）是什么？

"提交"就是告诉 Git："我现在的修改很重要，请帮我记录下来。"

每次提交都会生成一条记录，包含：
- 修改了哪些文件
- 什么时候修改的
- 一句话描述（提交信息）

### 标签（Tag）是什么？

标签就是给某次提交起一个好记的名字。

比如你的项目做到一个阶段了，你可以打一个标签 `0.0.1`，表示"这是第一个可用的版本"。

---

## 这套工具帮你做了什么？

我们配置了两个功能：

### 功能一：自动提交（后台静默运行）

当你用 Claude Code 写代码时，系统会在后台自动帮你：
1. 检查你改了多少文件
2. 如果改动足够多（2个文件以上，或50行以上）
3. 并且距离上次提交超过5分钟
4. 就自动帮你提交一次，并打上版本号

**你完全不需要做任何事情**，它在后台默默工作。

### 功能二：手动提交（需要时使用）

如果你想立刻提交（不想等5分钟，或者改动很小但很重要），可以手动触发。

---

## 如何使用？

### 自动提交：什么都不用做

只要你在用 Claude Code 编辑文件，系统会自动工作。

你可以通过以下方式确认它在工作：

```bash
git log --oneline -5
```

你会看到类似这样的记录：
```
4806750 Auto: 2025-12-06T22-20-59 - 26 files, 4886 lines
6ef7e62 Auto: 2025-12-06T08-54-06 - 8 files, 531 lines
```

### 手动提交：使用 /git-commit 命令

当你想立刻提交时：

**第一步**：在 Claude Code 中输入 `/git-commit`

**第二步**：Claude 会自动执行以下操作：
1. 检查有没有需要提交的内容
2. 把所有修改打包提交
3. 创建一个新的版本号

**第三步**：你会看到类似这样的结果：
```
已完成自动提交和打 tag：
- 提交: Auto: 2025-12-06T22-20-59 - 26 files, 4886 lines
- 新 Tag: 0.0.17
```

---

## 常见问题

### Q: 我怎么知道自动提交有没有在工作？

在终端输入：
```bash
git log --oneline -5
```

如果看到以 `Auto:` 开头的提交记录，说明在正常工作。

### Q: 我想看看现在有哪些版本号？

在终端输入：
```bash
git tag
```

会列出所有版本号，比如：
```
0.0.1
0.0.2
0.0.3
...
0.0.17
```

### Q: 我想回到之前的某个版本怎么办？

假设你想回到 `0.0.10` 版本：
```bash
git checkout 0.0.10
```

想回到最新版本：
```bash
git checkout main
```

### Q: 自动提交的条件是什么？

必须同时满足以下条件才会自动提交：
1. 距离上次提交超过 **5 分钟**
2. 修改了 **2 个以上文件** 或者 修改了 **50 行以上代码**

如果你的修改很小或者时间很短，系统不会频繁提交，避免产生太多无意义的记录。

### Q: 我不想等5分钟，想立刻提交怎么办？

使用 `/git-commit` 命令，它会绕过时间限制，立刻提交。

### Q: 这些提交会自动上传到网上吗？

**不会**。所有操作都只在你的电脑本地进行。

如果你想上传到 GitHub 或其他平台，需要手动执行：
```bash
git push
```

### Q: 我可以修改自动提交的条件吗？

可以。在终端设置环境变量：

```bash
# 把最小间隔改成 10 分钟（单位是秒）
export GIT_AUTO_TAG_MIN_INTERVAL=600

# 把最小文件数改成 3 个
export GIT_AUTO_TAG_MIN_FILES=3

# 把最小行数改成 100 行
export GIT_AUTO_TAG_MIN_LINES=100
```

---

## 小贴士

1. **不用担心提交太多**：Git 的提交记录不占多少空间，多提交比少提交好
2. **版本号只增不减**：0.0.1 → 0.0.2 → 0.0.3，永远往上涨
3. **出错了也不怕**：Git 可以随时回退，大胆尝试
4. **养成好习惯**：重要修改后，用 `/git-commit` 手动提交一下

---

## 总结

| 功能 | 触发方式 | 你需要做什么 |
|------|---------|-------------|
| 自动提交 | 后台自动 | 什么都不用做 |
| 手动提交 | `/git-commit` | 输入命令即可 |

现在你已经有了一个自动的"版本管理助手"，它会默默帮你记录每一次重要的修改。专心写代码吧，版本管理的事情交给它！
